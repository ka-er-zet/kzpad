<!DOCTYPE html>
<html lang="pl" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edytor Bazy Danych - KZ-PAD</title>
    <link rel="stylesheet" href="css/pico.min.css">
    <link rel="stylesheet" href="css/editor.css">
</head>
<body>
    <header class="app-header">
        <a href="#main-content" class="skip-link" aria-label="Pomiń nawigację do treści głównej">Pomiń nawigację</a>
        <div id="toast-container"></div>
        <div class="header-content">
            <a href="editor.html" id="app-logo" class="header-icon-container" aria-label="Edytor KZ-PAD">
                <img src="img/eaa.svg" class="app-logo-svg" alt="" aria-hidden="true" />
            </a>
            <div>
                <strong class="header-title">Edytor KZ-PAD</strong>
                <div class="muted" style="font-size:0.85rem">Zarządzanie bazą klauzul i mapowań</div>
            </div>
        </div>

        <nav class="header-actions" aria-label="Menu edytora">
            <button id="btn-download-json-nav" class="outline secondary icon-btn" aria-label="Pobierz JSON" title="Pobierz JSON">
                <i data-lucide="download-cloud" aria-hidden="true"></i>
            </button>

            <button id="btn-theme-toggle" class="outline secondary icon-btn theme-toggle" aria-label="Zmień motyw" title="Zmień motyw">
                <i id="theme-icon" data-lucide="moon" aria-hidden="true"></i>
            </button>
        </nav>
    </header>

    <main class="container">
        <!-- Wybierz kategorię do edycji (hero-style) -->
        <header style="margin-bottom:1rem; text-align:center;">
            <h1 style="margin-bottom:0.75rem;">Wybierz kategorię do edycji</h1>
            <p class="muted" style="margin-top:0; margin-bottom:0.5rem;">Najpierw wybierz typ danych, potem wczytaj plik i przejdź do edycji.</p>
        </header>

        <nav class="editor-nav" id="file-type-selector" style="margin-bottom:1rem;">
            <ul class="editor-hero-grid" role="list">
                <li>
                    <button class="hero-card" data-type="clauses" aria-pressed="false">
                        <span class="hero-card-icon" aria-hidden="true"><i data-lucide="book-open"></i></span>
                        <span class="hero-card-content"><p class="hero-card-title">Klauzule</p><p class="hero-card-desc muted">Edytuj bazę klauzul</p></span>
                    </button>
                </li>

                <li>
                    <button class="hero-card" data-type="mapping" aria-pressed="false">
                        <span class="hero-card-icon" aria-hidden="true"><i data-lucide="map"></i></span>
                        <span class="hero-card-content"><p class="hero-card-title">Mapowania</p><p class="hero-card-desc muted">Przypisz klauzule do produktów</p></span>
                    </button>
                </li>

                <li>
                    <button class="hero-card" data-type="summaries" aria-pressed="false">
                        <span class="hero-card-icon" aria-hidden="true"><i data-lucide="file-text"></i></span>
                        <span class="hero-card-content"><p class="hero-card-title">Podsumowania</p><p class="hero-card-desc muted">Szablony podsumowań</p></span>
                    </button>
                </li>

                <li>
                    <button class="hero-card" data-type="glossary" aria-pressed="false">
                        <span class="hero-card-icon" aria-hidden="true"><i data-lucide="book"></i></span>
                        <span class="hero-card-content"><p class="hero-card-title">Słownik</p><p class="hero-card-desc muted">Definicje i pojęcia</p></span>
                    </button>
                </li>
            </ul>
        </nav>

        <!-- Sekcja ładowania plików (pokazywana po wybraniu typu) - kompaktowy widok -->
        <section id="loader-section" class="hidden" aria-labelledby="loader-title">
            <h2 id="loader-title" class="loader-title" tabindex="-1">Wczytaj pliki</h2>
            <div class="loader-compact">
                <div class="loader-card">
                    <div class="loader-icon"><i data-lucide="download-cloud" aria-hidden="true"></i></div>
                    <div class="loader-body">
                        <div class="loader-title">Załaduj domyślne</div>
                        <div class="loader-desc"><small>Użyj plików z repozytorium aplikacji</small></div>
                    </div>
                    <div class="loader-action">
                        <button id="btn-load-defaults" class="primary small">Wczytaj</button>
                    </div>
                </div>

                <div class="loader-card">
                    <div class="loader-icon"><i data-lucide="upload-cloud" aria-hidden="true"></i></div>
                    <div class="loader-body">
                        <div class="loader-title">Wczytaj plik</div>
                        <div class="loader-desc"><small>Załaduj lokalny plik JSON</small></div>
                    </div>
                    <div class="loader-action">
                        <input type="file" id="file-input" accept=".json" style="display:none">
                        <label for="file-input" class="primary small" role="button">Wybierz plik</label>
                    </div>
                </div>
            </div>
        </section>

        <!-- Obszar edycji (ukryty do czasu załadowania danych) -->
        <div class="editor-title-container hidden">
            <h2 id="editor-title" class="editor-title" style="margin-top: 1.5rem; margin-bottom: 0;" tabindex="-1">
                Edycja: <span id="editor-category-name">(brak)</span>
            </h2>
        </div>
        <div id="editor-secondary-actions" class="hidden" style="margin-bottom: 1.5rem;">
            <button id="btn-show-loader" class="primary outline small" style="width: auto;">Wczytaj inny plik</button>
        </div>
        <section id="editor-workspace" class="hidden" aria-labelledby="editor-title">

            <div class="sticky-controls">
            </div>

            <div class="editor-container">
                <aside class="editor-sidebar">
                </aside>
                
                <div class="editor-main">
                    <div id="quick-filters" class="hidden">
                        <button class="outline secondary small filter-btn" data-prefix="C." onclick="setPrefixFilter('C.')">EN 301 549 (C.)</button>
                        <button class="outline secondary small filter-btn" data-prefix="U." onclick="setPrefixFilter('U.')">Ustawa (U.)</button>
                        <button class="outline secondary small filter-btn active" data-prefix="" onclick="setPrefixFilter('')">Wszystkie</button>
                    </div>
                    <div id="special-actions" style="margin-bottom: 2rem;"></div>
                    <input type="search" id="sidebar-search" placeholder="Szukaj..." aria-label="Wyszukaj na liście">
                    <div id="add-item-actions" style="margin-top: 0.5rem; margin-bottom: 1rem;">
                        <button id="btn-add-new" class="primary small" style="width: auto;">+ Dodaj nowe mapowanie</button>
                    </div>
                    <div id="items-list">
                        <!-- Lista elementów (klauzul/artykułów) -->
                    </div>
                    <div id="form-container">
                        <p class="secondary">Wybierz element z listy, aby rozpocząć edycję.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="container" style="text-align: center; margin-top: 2rem; padding-bottom: 2rem;">
        <hr>
        <p class="muted" style="font-size: 0.85rem;">&copy; 2026 KZ-PAD Editor. Narzędzie do zarządzania bazą danych treści.</p>
    </footer>

    <!-- Modal for adding new item -->
    <dialog id="modal-add-item" aria-labelledby="modal-add-title">
        <article>
            <header>
                <a href="#close" aria-label="Zamknij" class="close" onclick="closeAddItemModal()"></a>
                <h2 id="modal-add-title">Dodaj nowy element</h2>
            </header>
            <div>
                <p>Podaj identyfikator nowego elementu. Rekomendowane formaty:</p>
                <ul id="modal-add-hints" style="font-size: 0.85rem; margin-bottom: 1rem;">
                    <li><strong>U.7.1.2.a-01</strong> - Ustawa (Art. 7 ust. 1 pkt 2 lit. a tiret 1)</li>
                    <li><strong>C.9.1.1.1</strong> - Norma EN (Rozdział 9.1.1.1)</li>
                </ul>
                <div class="field-group">
                    <label for="new-item-id">Identyfikator (ID)</label>
                    <input type="text" id="new-item-id" placeholder="np. C.9.2.1.1">
                </div>
            </div>
            <footer>
                <button class="secondary outline" onclick="closeAddItemModal()">Anuluj</button>
                <button id="btn-confirm-add" onclick="confirmAddItem()">Dodaj element</button>
            </footer>
        </article>
    </dialog>

    <!-- Modal for generic confirmation -->
    <dialog id="modal-confirm">
        <article>
            <header>
                <a href="#close" aria-label="Anuluj" class="close" onclick="closeConfirmModal(false)"></a>
                <h2 id="modal-confirm-title">Potwierdzenie</h2>
            </header>
            <p id="modal-confirm-message">Czy na pewno chcesz wykonać tę akcję?</p>
            <footer>
                <button id="modal-confirm-cancel-btn" class="secondary outline" onclick="closeConfirmModal(false)">Anuluj</button>
                <button id="modal-confirm-btn" class="primary" onclick="closeConfirmModal(true)">Potwierdź</button>
            </footer>
        </article>
    </dialog>

    <script src="js/lucide.min.js"></script>
    <script src="js/editor.js"></script>
</body>
</html>
